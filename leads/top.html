{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="images/favicon.png">

  <title>Dealer Funnel</title>
 <link href='http://fonts.googleapis.com/css?family=Lato:400,300,700,800' rel='stylesheet' type='text/css'>

  <!-- Bootstrap core CSS -->
  <link href="{% static 'js/bootstrap/dist/css/bootstrap.css' %}" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" media="all" href="{% static 'css/dealerminer.css' %}" />

  <!-- Font Icon Packs -->
  <link href="{% static 'css/font-awesome-4.5.0/css/font-awesome.min.css' %}" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="{% static 'css/simple-line-icons/css/simple-line-icons.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static 'css/dealerfunnel-icons/flaticon.css' %}" />

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js' %}"></script>
    <![endif]-->
	<link rel="stylesheet" type="text/css" href="{% static 'js/jquery.gritter/css/jquery.gritter.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'js/jquery.datatables/bootstrap-adapter/css/datatables.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static 'js/jquery.nanoscroller/nanoscroller.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static 'js/jquery.easypiechart/jquery.easy-pie-chart.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'js/bootstrap.switch/bootstrap-switch.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'js/jquery.select2/select2.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'js/bootstrap.slider/css/slider.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'js/intro.js/introjs.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static 'js/jquery.datatables/bootstrap-adapter/css/datatables.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static 'js/bootstrap.multiselect/css/bootstrap-multiselect.css' %}"/>
  <link rel="stylesheet" type="text/css" href="{% static 'js/jquery.multiselect/css/multi-select.css' %}" />
  <script type="text/javascript" src="{% static 'js/jquery.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/jquery.gritter/js/jquery.gritter.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/jquery.nanoscroller/jquery.nanoscroller.js' %}"></script>
  <script src="{% static 'js/jquery.ui/jquery-ui.js" type="text/javascript' %}"></script>
	<script type="text/javascript" src="{% static 'js/jquery.sparkline/jquery.sparkline.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/jquery.easypiechart/jquery.easy-pie-chart.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/jquery.nestable/jquery.nestable.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/bootstrap.switch/bootstrap-switch.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js' %}"></script>
  <script src="{% static 'js/jquery.select2/select2.min.js" type="text/javascript' %}"></script>
  <script src="{% static 'js/skycons/skycons.js" type="text/javascript' %}"></script>
  <script src="{% static 'js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript' %}"></script>
  <script type="text/javascript" src="{% static 'js/jquery.datatables/jquery.datatables.min.js' %}"></script>

  <script type="text/javascript" src="{% static 'js/bootstrap.multiselect/js/bootstrap-multiselect.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/jquery.multiselect/js/jquery.multi-select.js' %}"></script>

  <script type="text/javascript" src="{% static 'js/jquery.flot/jquery.flot.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/jquery.flot/jquery.flot.pie.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/jquery.flot/jquery.flot.time.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/jquery.flot/jquery.flot.resize.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/jquery.flot/jquery.flot.labels.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/daterangepicker/moment.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/daterangepicker/daterangepicker.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/audiojs/audio.min.js' %}"></script>
  <script src= "http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
  <script type="text/javascript" src="{% static 'js/jquery.timeago.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/angular-moment.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/angular-timeago.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/angulagjsfilter.js' %}"></script>
  <!-- Custom styles for this template -->
  <link href="{% static 'css/style.css" rel="stylesheet' %}" />
  <link rel="stylesheet" type="text/css" media="all" href="{% static 'css/dealerminer.css' %}" />
<style>
.show
{
   display:inline-block;
   vertical-align: middle;
}
.hidden
{
   display:none;
}
</style>
<script>
function getLabelIcon(label)
{
   var labellist = ['','Hot','Cold','Sold','Warm','Follow Up','Dead'];
   return labellist[label];
}
function getLabelIconeClass(label)
{
   var labellist = ['','btn-danger','btn-primary','btn-green','btn-warning','btn-success','btn-inverse'];
   return labellist[label];
}
</script>
<script>
         var app = angular.module('selectcampaignapp',['angularMoment','yaru22.angular-timeago','commonfilter']);
         
                  
         app.controller("lead_leftpanel", function($scope,$http) {
            $scope.responsetype     = {};
            $scope.leadcount        = {};
            $scope.label            = {};
            $scope.responselead     = {};
            $scope.idLst            = [['hv1','sv1'],['hv2','sv2'],['hv3','sv3'],['hv4','sv4'],['leadcountdatahiddenId','leadcountdatashowId']];
            $scope.FlagLst          = [];
            $scope.toggole          = function(index)
            {
                if(!$scope.FlagLst[index])
                {
                   $('#'+$scope.idLst[index][1]).removeClass('hidden');
                   $('#'+$scope.idLst[index][0]).addClass('hidden');
                   $scope.FlagLst[index] = true;
                }
                else
                {
                   $('#'+$scope.idLst[index][0]).removeClass('hidden');
                   $('#'+$scope.idLst[index][1]).addClass('hidden');
                   $scope.FlagLst[index] = false;
                }
                
            }
              
            
            //===========================================
    		
    		$scope.setNewLeadsP = function()
            {
                if($scope.newleadcount>1)
                {
                   $scope.newleadPs = 's';
                }
                else
                {
                   $scope.newleadPs = '';
                }
                
            }          
    		
    		$scope.updateLeadAtt = function(leadid,att,val)
    		{
    		    
    		    $http.get("/api/updateleadatt/",
            			{
            				params:
            					{
            						"leadid":leadid,
            						"att":att,
            						"val":val
            					}
            			}
            	        ).then(function(response){});
    		    
    		}
    		$scope.getMarkedId = function()
			{
			    checkid = [];
			    $(".ckbox").each(function() {
			        Id=this.id;
			        if($('#'+Id).is(':checked'))
                    {
			        	checkid.push(Id);
			        }
			    });
			    return checkid;
			}
    		$scope.getLeadLocation   =  function(id)
    		{
    		    
    		    for(i=0;i<$scope.responselead.lead.length;i++)
    		    {
    		       if(id == $scope.responselead.lead[i].id)
    		       {
    		          return i;
    		       }
    		    }
    		    return -1;
    		}
    		$scope.saveowner         = function()
    		{
    		    var idlist      = $scope.getMarkedId();
    		    var selectowner = $('#owneroption').val();
    		    $('#modal-owner').modal('hide');
    		    unselectAll();
    		    $scope.updateLeadAtt(idlist.join(","),3,selectowner);
    		}
    		$scope.assignowner       = function()
    		{
    		    var idlist = $scope.getMarkedId();
    		    if(idlist.length>0)
    		    {
    		    	$('#modal-owner').modal();
    		    	
    		    }
    		}
    		$scope.exportall         = function()
    		{
    		    location.href = '/export/alllead/';
    		}
    		$scope.exportbyid        = function()
    		{
    		    var idlist = $scope.getMarkedId();
    		    if(idlist.length>0)
    		    {
    		    	unselectAll();
    		    	location.href = '/export/leadbyid/?id='+idlist.join(",");
    		    }
    		    
    		}
    		$scope.unassignowner     = function()
    		{
    		    var idlist = $scope.getMarkedId();
    		    if(idlist.length>0)
    		    {
    		    	$scope.updateLeadAtt(idlist.join(","),3,-1);
    		    }
    		    unselectAll();
    		}
    		$scope.savecommonlabel   = function()
    		{
    		    var selectLabel = $('#labeloptioncommon').val();
    		    idlist = $scope.getMarkedId();
    		    for(i=0;i<idlist.length;i++)
    		    {
    		       loc = $scope.getLeadLocation(idlist[i]);
    		       $scope.changeLabelvalue($scope.responselead.lead[loc].label,-1);
    		       $scope.changeLabelvalue(selectLabel,1);
    		       $scope.responselead.lead[loc].iconeClass = getLabelIconeClass(selectLabel);
    		       $scope.responselead.lead[loc].icone      = getLabelIcon(selectLabel);
    		       $scope.responselead.lead[loc].label      = selectLabel;
    		    }
    		    $('#modal-label-common').modal('hide');
    		    unselectAll();
    		    var id = idlist.join(",");
    		    $scope.updateLeadAtt(id,2,selectLabel);
    		}
    		$scope.changelabelcommon = function()
    		{
    		    idlist = $scope.getMarkedId();
    		    if(idlist.length>0)
    		    {
    		    	$('#modal-label-common').modal();
    		    }
    		}
    		$scope.markedasnew  =  function(f1)
    		{
    		    idlist = $scope.getMarkedId();
    		    idlst  = [];
    		    if(f1 == 1)
    		    {
    		       f2 = 0;
    		    }
    		    else
    		    {
    		       f2 = 1; 
    		    }
    		    k = 0;
    		    for(i=0;i<idlist.length;i++)
    		    {
    		        id = idlist[i];
    		        loc = $scope.getLeadLocation(id);
    		        if($scope.responselead.lead[loc].isnew == f2)
    		        {
    		           idlst[k] = id;
    		           k++ ; 
    		           if(f1 == 0)
    		           {
    		           		$scope.newleadcount--;
    		           }
    		           else
    		           {
    		                $scope.newleadcount++;
    		           }
    		           $scope.responselead.lead[loc].isnew = f1;
    		        }
    		    }
    		    if(idlst.length>0)
    		    {
    		    	var id = idlst.join(",");
    		    	$scope.updateLeadAtt(id,1,f1);
    		    }
    		    unselectAll();
    		}
    		
    		$scope.adjustnewlead =  function(leadid,isnew)
    		{
                if(isnew == 1)
    		    {
    		    	$scope.newleadcount--;
    		    	loc = $scope.getLeadLocation(leadid);
    		    	$scope.responselead.lead[loc].isnew = 0;
    		    	$http.get("/api/adjustnewlead/",
            			{
            				params:
            					{
            						"leadid":leadid
            					}
            			}
            	        ).then(function(response){});
    		    	
    		    }    		   
    		}
    		$scope.leadmodal = function(type,leadid,cid,isnew)
    		{
    		    $scope.adjustnewlead(leadid,isnew);
    		    $http.get("/api/getresponseinfo/",
            			{
            				params:
            					{
            						"cid"    : cid,
            						"type"   : type
            					}
            			}
            	        ).then(function(response)
            	        {
            	            
            	            if(type == 3)
            	            {
            	               $scope.webmodal   = response.data;
            	               $('#modal-weblead').modal();
            	            }
            	            if(type == 1)
            	            {
            	               $scope.phonemodal   = response.data;
            	               $('#modal-phonelead').modal();
            	            }
            	            
            	        });
            	       
    		}
    		$scope.sorting  = function(colum)
    		{
    		   if(colum == $scope.sortcolum)
    		   {
    		      if($scope.sortorder == 1)
    		      { 
    		         $scope.sortorder = 0;
    		      }
    		      else
    		      {
    		         $scope.sortorder = 1;
    		      }
    		   }
    		   else
    		   {
    		        $scope.sortorder = 1;
    		        $scope.sortcolum = colum;
    		   }
    		   $scope.leaddata(true);
    		};
    		$scope.changeLabelvalue = function(label,flag)
    		{
    		   
    		   if(label==1) {$scope.labelcount.Hot=$scope.labelcount.Hot+flag;}
    		   if(label==2) {$scope.labelcount.Cold=$scope.labelcount.Cold+flag;}
    		   if(label==3) {$scope.labelcount.Sold=$scope.labelcount.Sold+flag;}
    		   if(label==4) {$scope.labelcount.Warm=$scope.labelcount.Warm+flag;}
    		   if(label==5) {$scope.labelcount.Folloup=$scope.labelcount.Folloup+flag;}
    		   if(label==6) {$scope.labelcount.Dead=$scope.labelcount.Dead+flag;}
    		};
    		
    		$scope.savelabel  = function()
    		{
    		   
    		   var id  = $scope.leadidforlabel;
    		   var selectLabel = $('#labeloption').val();
    		   $http.get("/api/changelabel/",
            			{params:{"id":id, "label": selectLabel}}
            	     ).then(function(response){});
    		   
    		   var temp = 0;
    		   for(i=0;i<$scope.responselead.lead.length;i++)
    		   {
    		      if($scope.responselead.lead[i].id == $scope.leadidforlabel)
    		      {
    		         temp = i;
    		      }
    		   }
    		   $scope.responselead.lead[temp].iconeClass = getLabelIconeClass(selectLabel);
    		   $scope.responselead.lead[temp].icone = getLabelIcon(selectLabel);
    		   $('#modal-status').modal('hide');
    		   $scope.changeLabelvalue(selectLabel,1);
    		   $scope.changeLabelvalue($scope.previouslabel,-1);
    		};
    		
    		$scope.labelmodal = function(leadid,label)
    		{
    		   $scope.leadidforlabel = leadid;
    		   $scope.previouslabel = label;
    		   $("#labeloption").val(label);
    		   $('#modal-status').modal();
    		}
    		$scope.iszero        = function(list)
    		{  
    		    for(i=0;i<list.length;i++)
    		    {
    		       if(list[i]=='0')
    		       {
    		          return 1;
    		       }
    		    }
    		    return 0;
    		};
    		$scope.setcampaignselect = function()
    		{
    		   var piszero = $scope.iszero($scope.pcampaignselect);
    		   var iszero = $scope.iszero($scope.campaignselect);
    		   var lst = [];
    		   if((piszero==1) && (iszero==1))
    		   {
    		      for(i=0;i<$scope.campaignselect.length;i++)
    		      {
    		         if($scope.campaignselect[i]!='0')
    		         {
    		         	lst.push($scope.campaignselect[i]);
    		         }
    		      }
    		      $scope.pcampaignselect = lst;
    		      $scope.campaignselect  = lst;
    		      $('#campaignlist option[value="0"]').prop('selected', false);
    		      $('#campaignlist').multiselect('refresh');
    		   }
    		   if((piszero==0) && (iszero == 1))
    		   {
    		      $scope.pcampaignselect = ['0'];
    		      $scope.campaignselect  = ['0'];
    		      $('#campaignlist option[value="0"]').prop('selected', true);
    		      for(i=0;i<$scope.selectedcampaign.length;i++)
    		      {
    		      	$('#campaignlist option[value="'+ $scope.selectedcampaign[i].id + '"]').prop('selected', false);
    		      }
    		      $('#campaignlist').multiselect('refresh');
    		   }
    		}
    		$scope.setresponsetypechange = function()
    		{
    		   var piszero = $scope.iszero($scope.pselectedresponse);
    		   var iszero = $scope.iszero($scope.selectedresponse);
    		   var lst = [];
    		   if((piszero==1) && (iszero==1))
    		   {
    		      for(i=0;i<$scope.selectedresponse.length;i++)
    		      {
    		         if($scope.selectedresponse[i]!='0')
    		         {
    		         	lst.push($scope.selectedresponse[i]);
    		         }
    		      }
    		      $scope.pselectedresponse = lst;
    		      $scope.selectedresponse  = lst;
    		      $('#responsetypeid option[value="0"]').prop('selected', false);
    		      $('#responsetypeid').multiselect('refresh');
    		   }
    		   if((piszero==0) && (iszero == 1))
    		   {
    		      $scope.pselectedresponse = ['0'];
    		      $scope.selectedresponse  = ['0'];
    		      $('#responsetypeid option[value="0"]').prop('selected', true);
    		      for(i=1;i<=3;i++)
    		      {
    		      	$('#responsetypeid option[value="'+ i + '"]').prop('selected', false);
    		      }
    		      $('#responsetypeid').multiselect('refresh');
    		   }
    		};
    		$scope.settrigger    = function()
    		{
    		   var piszero = $scope.iszero($scope.ptriggerselect);
    		   var iszero = $scope.iszero($scope.triggerselect);
    		   var lst = [];
    		   if((piszero==1) && (iszero==1))
    		   {
    		      for(i=0;i<$scope.triggerselect.length;i++)
    		      {
    		         if($scope.triggerselect[i]!='0')
    		         {
    		         	lst.push($scope.triggerselect[i]);
    		         }
    		      }
    		      $scope.ptriggerselect = lst;
    		      $scope.triggerselect  = lst;
    		      $('#triggerid option[value="0"]').prop('selected', false);
    		      $('#triggerid').multiselect('refresh');
    		   }
    		   if((piszero==0) && (iszero == 1))
    		   {
    		      $scope.ptriggerselect = ['0'];
    		      $scope.triggerselect  = ['0'];
    		      $('#triggerid option[value="0"]').prop('selected', true);
    		      for(i=1;i<=9;i++)
    		      {
    		      	$('#triggerid option[value="'+ i + '"]').prop('selected', false);
    		      }
    		      $('#triggerid').multiselect('refresh');
    		   }
    		};
    		$scope.responsetypechange = function()
    		{
    		   $scope.setresponsetypechange();
    		   $scope.leadCount(true);
        	   $scope.labelCount(true);
               $scope.newleadCount(true);
               $scope.leaddata(true);
    		};
    		$scope.campaignchange = function()
    		{
    		   $scope.setcampaignselect();
    		   $scope.leadCount(true);
        	   $scope.labelCount(true);
               $scope.newleadCount(true);
               $scope.leaddata(true);
    		   
    		};
    		
    		$scope.triggerchange = function()
    		{
    		   $scope.settrigger();
    		   $scope.leadCount(true);
        	   $scope.labelCount(true);
               $scope.newleadCount(true);
               $scope.leaddata(true);
    		};
    		$scope.previouspage = function()
    		{
    		   if($scope.responselead.currentpage>1)
    		   {
    		     $scope.responselead.currentpage--;
    		     $scope.page = $scope.responselead.currentpage;
    		     $scope.leaddata(true);
    		   } 
    		   
    		}
    		$scope.nextpage = function()
    		{
    		 
    		  if($scope.responselead.currentpage<$scope.responselead.totalpage)
    		  {
    		     $scope.responselead.currentpage++;
    		     $scope.page = $scope.responselead.currentpage;
    		     $scope.leaddata(true);
    		  } 
    		};
    		$scope.getLeadByLead  = function()
    		{
    		    $scope.slabel = 0;
    		    $scope.page   = 1;
    		    $scope.newleadCount(true);
                $scope.leaddata(true);
    		}
    		$scope.getLeadByLabel = function(label)
    		{
    		    $scope.slabel = label;
    		    $scope.page   = 1;
    		    $scope.newleadCount(true);
                $scope.leaddata(true);
    		}
    		$scope.leaddata = function(flag)
    		{
    		   if(flag) { $scope.toggole(3); }
    		   $http.get("/api/getlead/",
                {
                  params:
                     {
                         "start":$scope.startDate,
                         "end":$scope.endDate,
                         "dealer":$scope.dealer,
                         "responsetype":$scope.selectedresponse.join(","),
                         "label":$scope.slabel,
                         "trigger":$scope.triggerselect.join(","),
                         "campaign":$scope.campaignselect.join(","),
                         "page":$scope.page,
                         "sortcolum":$scope.sortcolum,
                         "sortorder":$scope.sortorder
                         
                      }
                 }).then(function(response) 
    			 {
    					$scope.responselead = response.data;
    					$scope.toggole(3);
    					
    			 });
    		};
    		
    		$scope.getcampaignbyrange = function()
    		{
    		    $http.get("/api/getcampaignbydate/",
                {
                  params:
                     {
                         "start":$scope.startDate,
                         "end":$scope.endDate,
                         "dealer":$scope.dealer
                     }
                 }).then(function(response) 
    			 {
    					$scope.selectedcampaign = response.data.campaign;
    					str = "<option selected value='0'>N/A</option>";
    					for(i=0;i<$scope.selectedcampaign.length;i++)
    					{
    						str = str + "<option value='"+ $scope.selectedcampaign[i].id + "'>"+$scope.selectedcampaign[i].name + "</option>";
    					}
    					str = str + "<option value='n'>Campaign</option>";
    					$('#campaignlist').html(str);
    					$('#campaignlist').multiselect('rebuild');
    					
    			 });
    		};
    		$scope.newleadCount = function(flag)
    		{
    		    if(flag) { $scope.toggole(2); }
    		    $http.get("/api/getnewleadcount/",
                {
                  params:
                     {
                         "start":$scope.startDate,
                         "end":$scope.endDate,
                         "dealer":$scope.dealer,
                         "responsetype":$scope.selectedresponse.join(","),
                         "label":$scope.slabel,
                         "trigger":$scope.triggerselect.join(","),
                         "campaign":$scope.campaignselect.join(",")
                         
                      }
                 }).then(function(response) 
    			 {
    					$scope.newleadcount = response.data.newlead;
    					$scope.setNewLeadsP();
    					$scope.toggole(2);
    					
    			 });
    		}
    		$scope.labelCount = function(flag)
    		{
    		   if(flag) { $scope.toggole(1); }
    		   $http.get("/api/getresponselabel/",
                {
                  params:
                     {
                         "start":$scope.startDate,
                         "end":$scope.endDate,
                         "dealer":$scope.dealer,
                         "responsetype":$scope.selectedresponse.join(","),
                         "trigger":$scope.triggerselect.join(","),
                         "campaign":$scope.campaignselect.join(",")
                         
                      }
                 }).then(function(response) 
    			 {
    					$scope.labelcount = response.data.label;
    					$scope.toggole(1);
    					
    			 });
    		}
    		
    		$scope.leadCount = function(flag)
    		{
    		    if(flag) { $scope.toggole(0); }
    		    $http.get("/api/getleadcount/",
                {
                  params:
                     {
                         "start":$scope.startDate,
                         "end":$scope.endDate,
                         "dealer":$scope.dealer,
                         "responsetype":$scope.selectedresponse.join(","),
                         "trigger":$scope.triggerselect.join(","),
                         "campaign":$scope.campaignselect.join(",")
                         
                      }
                 }).then(function(response) 
    			 {
    					$scope.leadcount = response.data.count;
    					$scope.toggole(0);
    					
    			 });
    		}
    		
    		
    		$scope.init = function () {
    		   $scope.FlagLst          = [false,false,false,false,false];
    		   $scope.newlead          = 0;
    		   $scope.startDate        = $('#startDate').val();
               $scope.endDate          = $('#endDate').val();
               $scope.dealer           = $('#dealerkeyid').val();
               $scope.page             = 1;
               $scope.menuclass        = ['active','','','','','','','','',''];
               
               
               
               
               
               $scope.webmodal         = {};
               $scope.phonemodal       = {};
               $scope.smsmodal         = {};
               
               //============================
               
               $scope.triggerselect    = ['0'];
               $scope.ptriggerselect   = ['0'];
               $scope.campaignselect   = ['0'];
               $scope.pcampaignselect  = ['0'];
               $scope.pselectedresponse = ['0'];
               $scope.selectedresponse  = ['0'];
               $scope.selectedcampaign = {};
               $scope.newleadPs        = '';
               $scope.slabel           = 0;
               $scope.newleadcount     = {};
               $scope.labelcount       = {};
               $scope.leadcount        = 0;
               $scope.sortcolum        = 4;
               $scope.sortorder        = 1;
    		};
    		
    		$scope.init();
         });
         
         
         
         app.config(function($interpolateProvider) {
  			$interpolateProvider.startSymbol('{[{');
  			$interpolateProvider.endSymbol('}]}');
		 });
         
</script>   
<script type="text/javascript">
function setDateRange(hstartDate,hendDate)
{
      
      $('#reportrange').daterangepicker(
       {
          startDate: moment(hstartDate,"YYYY-MM-DD"),
          endDate: moment(hendDate,"YYYY-MM-DD"),
          minDate: '01/01/2013',
          maxDate: '12/31/2016',
          dateLimit: { days:1000},
          showDropdowns: true,
          showWeekNumbers: true,
          timePicker: false,
          timePickerIncrement: 1,
          timePicker12Hour: true,
          ranges: {
             'Today': [moment(), moment()],
             'Yesterday': [moment().subtract('days', 1), moment().subtract('days', 1)],
             'Last 7 Days': [moment().subtract('days', 6), moment()],
             'Last 30 Days': [moment().subtract('days', 29), moment()],
             'This Month': [moment().startOf('month'), moment().endOf('month')],
             'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')],
             
             

          },
          opens: 'right',
          buttonClasses: ['btn'],
          applyClass: 'btn-sm btn-primary',
          cancelClass: 'btn-sm btn-inverse',
          format: 'MM/DD/YYYY',
          separator: ' to ',
          locale: {
              applyLabel: 'Submit',
              fromLabel: 'From',
              toLabel: 'To',
              customRangeLabel: 'Custom Range',
              daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr','Sa'],
              monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
              firstDay: 1
          }
       },
       function(start, end) {
        $('#endDate').val(end.format('YYYY-MM-DD'));    
        $('#startDate').val(start.format('YYYY-MM-DD'));
        $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
        
        var leftpanelScop = angular.element($("#lead_leftpanel")).scope();
    	leftpanelScop.$apply(function(){
        	
        	leftpanelScop.startDate = start.format('YYYY-MM-DD');
        	leftpanelScop.endDate = end.format('YYYY-MM-DD');
        	leftpanelScop.leadCount(true)
        	leftpanelScop.labelCount(true)
        	leftpanelScop.newleadCount(true)
        	leftpanelScop.getcampaignbyrange();
        	leftpanelScop.leaddata(true);
        	
    	});  
       }
    );
    //Set the initial state of the picker label
    $('#reportrange span').html(moment(hstartDate,"YYYY-MM-DD").format('MMMM D, YYYY') + ' - ' + moment(hendDate,"YYYY-MM-DD").format('MMMM D, YYYY'));
    
}  

</script>
<script>
$(document).ready(function() {
    
    
    $('#startDate').html(moment().subtract('days', 29).format('YYYY-MM-DD'));
    $('#endDate').html(moment().format('YYYY-MM-DD'));
    setDateRange(moment().subtract('days', 29).format('YYYY-MM-DD'),moment().format('YYYY-MM-DD'));
    var leftpanelScop = angular.element($("#lead_leftpanel")).scope();
    leftpanelScop.$apply(function(){
        leftpanelScop.startDate = moment().subtract('days', 29).format('YYYY-MM-DD');
        leftpanelScop.endDate = moment().format('YYYY-MM-DD');
        leftpanelScop.leadCount(false)
        leftpanelScop.labelCount(false)
        leftpanelScop.newleadCount(false)
        leftpanelScop.getcampaignbyrange();
        leftpanelScop.leaddata(false);
        
        
    });
    
 });
 function dealerrequest(dealerid,dealername,keyid)
  {
     $('#selectedid').val(dealerid);
     $('#selected_dealer_name').html(dealername);
     $('#selectedkeyid').val(keyid);
     $.get('/ajax/dealer/select/',{select_id:dealerid},function(data, status){});
     $('#startDate').html(moment().subtract('days', 29).format('YYYY-MM-DD'));
     $('#endDate').html(moment().format('YYYY-MM-DD'));
     setDateRange(moment().subtract('days', 29).format('YYYY-MM-DD'),moment().format('YYYY-MM-DD'));
     var leftpanelScop = angular.element($("#lead_leftpanel")).scope();
     leftpanelScop.$apply(function(){
        leftpanelScop.startDate = moment().subtract('days', 29).format('YYYY-MM-DD');
        leftpanelScop.endDate = moment().format('YYYY-MM-DD');
        leftpanelScop.dealer = keyid;
        leftpanelScop.leadCount(true)
        leftpanelScop.labelCount(true)
        leftpanelScop.newleadCount(true)
        leftpanelScop.getcampaignbyrange();
        leftpanelScop.leaddata(true);
     });
  }
</script>
</head>
<body ng-controller='lead_leftpanel' id='lead_leftpanel' ng-app='selectcampaignapp'>

  <!-- Fixed navbar -->
  <div id="head-nav" class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="fa fa-gear"></span>
        </button>
        <a class="navbar-brand" href="index.html"><strong>Dealer</strong>Funnel</a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span id="selected_dealer_name" >{{ dealerlist.selecteddealer.name }}</span><b class="caret"></b></a>
            <ul class="dropdown-menu">
              {% for n in dealerlist.dealerlist  %}
              <li><a onclick="dealerrequest('{{n.id}}','{{n.name}}','{{n.keyid}}')" href="javascript:void(0)">{{ n.name }}</a></li>
              {% endfor %}
               
            </ul>
          </li>
          
        </ul>
        <ul class="nav navbar-nav navbar-right user-nav">
        <li class="dropdown profile_menu">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="toolbar-avatar"><img src="{{userinfo.image}}" /></span><span>{{userinfo.name}}</span> <b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a href="/setting/account"><i class="icon-settings"></i> Settings</a></li>
            <li class="divider"></li>
            <li><a href="/logout"><i class="icon-logout"></i> Sign Out</a></li>
          </ul>
        </li>
     </ul>     

      </div><!--/.nav-collapse animate-collapse -->
    </div>
  </div>

	<div id="cl-wrapper" class="fixed-menu sb-collapsed">
			<ul class="funnel-mainnav">
    <li {% if menu.base == 'DASHBOARD' %}  class="active" {% endif %} ><a href="{% url 'dashboard_landing' %}">
    <i class="icon-speedometer"></i> <span>Dashboard</span></a></li>
    <li {% if menu.base == 'CAMPAIGN' %}  class="active" {% endif %} ><a href="{% url 'campaign_landing' %}"><i class="icon-folder"></i> <span>Campaigns</span></a></li>
    <li {% if menu.base == 'CUSTOMER' %}  class="active" {% endif %} ><a href="{% url 'customer_landing' %}"><i class="icon-user"></i> <span>Customers</span></a></li>
    <li><a href="{% url 'leads_landing' %}"><i class="icon-star"></i> <span>Leads</span> <span class="label label-primary">22</span></a></li>
     <li {% if menu.base == 'HISTORICAL' %}  class="active" {% endif %} ><a href="{% url 'reports_historical' %}"><i class="icon-reload"></i>  Historical</a></li>
    <li {% if menu.base == 'MARKETANALYSIS' %}  class="active" {% endif %}><a href="{% url 'reports_marketanalysis' %}"><i class="icon-graph"></i>  Market Analysis</a></li>
    <li {% if menu.base == 'ROI' %}  class="active" {% endif %}><a href="{% url 'reports_roi' %}"><i class="icon-pie-chart"></i>  ROI</a></li>
    {% if userinfo.type = 1 %}
   <li {% if menu.base == 'DEALERSHIP' %}  class="active" {% endif %} ><a href="{% url 'dealership_landing' %}"><i class="icon-star"></i>  Dealerships</a></li>
        <li {% if menu.base == 'USER' %}  class="active" {% endif %} ><a href="{% url 'user_landing' %}"><i class="icon-user"></i>  Users</a></li>
    {% endif %}
  </ul>
	</div>